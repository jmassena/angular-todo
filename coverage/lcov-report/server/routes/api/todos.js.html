<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for server/routes/api/todos.js</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../../../prettify.css">
    <link rel="stylesheet" href="../../../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header high">
    <h1>Code coverage report for <span class="entity">server/routes/api/todos.js</span></h1>
    <h2>
        Statements: <span class="metric">92.68% <small>(38 / 41)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">64.71% <small>(11 / 17)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">100% <small>(8 / 8)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">92.68% <small>(38 / 41)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../index.html">All files</a> &#187; <a href="index.html">server/routes/api/</a> &#187; todos.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// routes.api.todos.js
&nbsp;
var express = require('express');
var router = express.Router();
var path = require('path');
var mongoose = require('mongoose');
&nbsp;
// var UserEvents = require('./../../data/user-events.js');
var Todo = require('./../../data/todo.js');
&nbsp;
&nbsp;
// GET
router.get('/users/:userId/todos', function(req, res, next) {
  'use strict';
&nbsp;
  // console.log('get called');
  var userId = req.params.userId;
&nbsp;
  Todo.get({ userId: userId })
  .then(onSuccess(200, res), onError(500, res));
&nbsp;
});
&nbsp;
&nbsp;
// POST
router.post('/users/:userId/todos', function(req, res, next) {
  'use strict';
&nbsp;
// console.log('posting data!!');
&nbsp;
  var userId = req.params.userId;
&nbsp;
  <span class="missing-if-branch" title="if path not taken" >I</span>if(!req.body){
<span class="cstat-no" title="statement not covered" >    return res.status(400) // 400: bad request</span>
      .json('body must contain a todo object json');
  }
  // make sure this doesn't exist already. cannot have an _id
  if(req.body._id){
    console.log('cannot have an id');
    return res.status(400) // 400: bad request
    //.json(new Error('new todo object _id must be null. _id: ' + req.body._id));
      .json({message: 'new todo object _id must be null. _id: ' + req.body._id});
  }
&nbsp;
  // 201: created
  Todo.add(userId, req.body)
  .then(onSuccess(201, res), onError(500, res));
&nbsp;
});
&nbsp;
&nbsp;
// DELETE
router.delete('/users/:userId/todos/:todoId', function (req, res, next){
  'use strict';
&nbsp;
  var userId = req.params.userId;
  var todoId = req.params.todoId;
&nbsp;
  Todo.deleteById(userId, todoId)
  .then(onSuccess(200, res), onError(500, res));
&nbsp;
});
&nbsp;
&nbsp;
// PUT
router.put('/users/:userId/todos/:todoId', function (req, res, next){
  'use strict';
&nbsp;
  var userId = Number(req.params.userId);
  var todoId = req.params.todoId;
  var todo = req.body;
&nbsp;
  <span class="missing-if-branch" title="if path not taken" >I</span>if(!todo.userId){
<span class="cstat-no" title="statement not covered" >    return res.status(400) // 400: bad request</span>
      .json('userId of object is not defined or is null');
  }
&nbsp;
  <span class="missing-if-branch" title="if path not taken" >I</span>if(Number(todo.userId) !== userId){
&nbsp;
&nbsp;
<span class="cstat-no" title="statement not covered" >    return res.status(400) // 400: bad request</span>
      .json('userId of object does not match userId in path. object userId: ' +
            todo.userId + ' path userId: ' + userId + ' ' +
            'obj type: ' + typeof(todo.userId) + ' userId type: ' + typeof(userId));
  }
&nbsp;
  // validate
  if(!todo._id || String(todo._id) !== String(todoId)){
    return res.status(400) // 400: bad request
    .json('id of object does not match id in path. object _id: ' + todo._id + ' path id: ' + todoId);
  }
&nbsp;
  Todo.update(todo)
  .then(onSuccess(200, res), onError(500, res));
&nbsp;
});
&nbsp;
&nbsp;
function onSuccess(code, res){
  'use strict';
&nbsp;
  // console.log('success call constructed');
&nbsp;
&nbsp;
  return function(data){
    // console.log('success call called');
&nbsp;
    return res.status(code).json(data);
  };
}
function onError(code, res){
  'use strict';
&nbsp;
  // console.log('error call constructed');
&nbsp;
&nbsp;
  return function(err){
    console.log('failure: ' + err);
    // console.log('error call called');
&nbsp;
&nbsp;
    code = err.statusCode || <span class="branch-1 cbranch-no" title="branch not covered" >code </span>|| <span class="branch-2 cbranch-no" title="branch not covered" >500;</span>
    var msg = err.message || <span class="branch-1 cbranch-no" title="branch not covered" >err;</span>
&nbsp;
    // console.log('error response: ' + JSON.stringify(msg));
    return res.status(code)
      .json({message: msg});
  };
}
&nbsp;
module.exports = router;
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat May 02 2015 11:02:44 GMT-0700 (PDT)</div>
</div>
<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../sorter.js"></script>
</body>
</html>
